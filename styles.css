/* styles.css
   Robust theming and layout system for timeline.
*/

:root {
  /* --- DEFAULT THEME (Dark Blue/Glass) --- */
  --bg-grad: linear-gradient(180deg, #0f1724 0%, #071026 100%);
  --text-main: #e6eef8;
  --text-muted: #9fb0cc;
  --card-bg: rgba(11, 19, 32, 0.85);
  --card-border: rgba(255, 255, 255, 0.08);
  --accent: #4f9cff;
  --accent-glow: rgba(79, 156, 255, 0.2);
  --font-body: 'Inter', ui-sans-serif, system-ui, sans-serif;
  --card-radius: 12px;
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);

  /* Layout vars */
  --timeline-padding: 40px;
  --card-width: 300px;
}

/* --- THEMES --- */

/* CYBERPUNK THEME */
body[data-theme="cyberpunk"] {
  --bg-grad: repeating-linear-gradient(0deg,
      transparent 0,
      transparent 1px,
      rgba(255, 0, 255, 0.05) 1px,
      rgba(255, 0, 255, 0.05) 2px),
    linear-gradient(to bottom, #050011, #120024);
  --text-main: #00f3ff;
  --text-muted: #ff00ff;
  --card-bg: rgba(10, 10, 10, 0.9);
  --card-border: #00f3ff;
  --accent: #ff00ff;
  --accent-glow: #00f3ff;
  --font-body: 'Courier New', Courier, monospace;
  --card-radius: 2px;
  --shadow: 0 0 15px rgba(0, 243, 255, 0.2);
}

/* MINIMAL THEME */
body[data-theme="minimal"] {
  --bg-grad: #f8f9fa;
  --text-main: #111;
  --text-muted: #666;
  --card-bg: #ffffff;
  --card-border: #eee;
  --accent: #111;
  --accent-glow: rgba(0, 0, 0, 0.05);
  --font-body: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  --card-radius: 4px;
  --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

/* RETRO THEME */
body[data-theme="retro"] {
  --bg-grad: #000000;
  --text-main: #33ff33;
  --text-muted: #22aa22;
  --card-bg: #001100;
  --card-border: #33ff33;
  --accent: #33ff33;
  --accent-glow: rgba(51, 255, 51, 0.2);
  --font-body: 'Press Start 2P', cursive, 'Courier New', monospace;
  /* Fallback to monospace if font not loaded */
  --card-radius: 0px;
  --shadow: none;
}

/* --- BASE STYLES --- */
* {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  background: var(--bg-grad);
  color: var(--text-main);
  font-family: var(--font-body);
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
}

/* Header */
.site-header {
  padding: 20px 40px;
  border-bottom: 1px solid var(--card-border);
  background: rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
  z-index: 100;
}

.site-title {
  font-size: 1.5rem;
  margin: 0;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.site-subtitle {
  color: var(--text-muted);
  margin: 0;
  font-size: 0.9rem;
}

.controls {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
}

.control-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.control-label {
  font-size: 0.8rem;
  color: var(--text-muted);
  text-transform: uppercase;
  font-weight: 600;
}

select,
button {
  background: var(--card-bg);
  color: var(--text-main);
  border: 1px solid var(--card-border);
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-family: inherit;
  font-size: 0.9rem;
  transition: all 0.2s;
}

select:hover,
button:hover {
  border-color: var(--accent);
  box-shadow: 0 0 10px var(--accent-glow);
}

.divider {
  width: 1px;
  height: 24px;
  background: var(--card-border);
}

/* Main Area */
main {
  flex: 1;
  position: relative;
  overflow: hidden;
  /* Important for different scroll modes */
  display: flex;
  justify-content: center;
  align-items: center;
}

.timeline-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  /* Default Horizontal Alignment */
  align-items: center;
  padding: var(--timeline-padding);
}

.timeline {
  /* Base styles (Horizontal by default) */
  display: flex;
  gap: 80px;
  /* More breathing room */
  padding: 60px 80px;
  overflow-x: auto;
  overflow-y: hidden;
  width: 100%;
  height: 100%;
  position: relative;
  align-items: center;
  /* Center alignment for the track */
  scroll-behavior: smooth;
  scrollbar-width: thin;
  scrollbar-color: var(--accent) transparent;
}

/* Horizontal Track Line (Pseudo-element) */
.timeline.view-horizontal::before {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  /* This might not cover scrolled area without min-width on container children */
  top: 50%;
  height: 4px;
  background: var(--card-border);
  transform: translateY(-50%);
  z-index: 0;
  width: max-content;
  /* Attempt to stretch to full content width */
  min-width: 100%;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2) inset;
}

/* Force container to recognize full width for pseudo element */
/* A trick is to use an empty spacer if needed, but 'width: max-content' usually works on the pseudo if the parent scrolls properly. 
   However, on some browsers position:absolute right:0 is relative to the viewport, not scroll width.
   We will rely on specific card styling to bridge the gaps if the line fails, but let's try a gradient on the background instead?
   
   Actually, a Linear Gradient on the background of .timeline works best for the track!
*/
.timeline.view-horizontal {
  background-image: linear-gradient(to right, transparent 0%, var(--card-border) 5%, var(--card-border) 95%, transparent 100%);
  background-position: 0 50%;
  background-size: 100% 4px;
  background-repeat: no-repeat;
  /* Note: Background size 100% relates to visible area + scroll? No, usually element width. 
       If element grows with scroll, it works. Flex containers grow. 
    */
}

/* Reset ::before if we use background approach to avoid duplicates, or keep it for glowing effect */
.timeline.view-horizontal::before {
  display: none;
}


.timeline::-webkit-scrollbar {
  height: 8px;
  width: 8px;
}

.timeline::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

.timeline::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

/* --- EVENT CARD (Horizontal Specifics) --- */
.timeline.view-horizontal .event {
  margin: 0;
  position: relative;
  z-index: 1;
  min-width: 250px;
}

/* Alternating Top/Bottom with TRANSFORM only (to preserve center alignment base) */
/* 
   Logic: 
   Center of card is at Center of Container.
   Odd: Move UP by (50% of self + 30px gap). Bottom edge is now 30px above center.
   Even: Move DOWN by (50% of self + 30px gap). Top edge is now 30px below center.
*/
.timeline.view-horizontal .event:nth-child(odd) {
  transform: translateY(calc(-50% - 30px));
}

.timeline.view-horizontal .event:nth-child(even) {
  transform: translateY(calc(50% + 30px));
}

/* Connector Line (Vertical) */
.timeline.view-horizontal .event::after {
  content: '';
  position: absolute;
  left: 50%;
  width: 2px;
  height: 30px;
  /* Gap size */
  background: var(--accent);
  /* Connector color */
  transform: translateX(-50%);
  opacity: 0.6;
  transition: all 0.3s;
}

/* Connector Position */
/* Odd (Top) -> Connector starts at bottom (100%) and goes down? 
   No, ::after is child. 
   If height is 30px:
   Odd: We want it to hang FROM the bottom OF the card TO the center line.
   Top: 100% (Bottom of card).
*/
.timeline.view-horizontal .event:nth-child(odd)::after {
  top: 100%;
}

/* Even (Bottom) -> Connector starts at top (0%) and goes UP ??
   If we use bottom: 100%, it sits on top of the card.
*/
.timeline.view-horizontal .event:nth-child(even)::after {
  bottom: 100%;
}

/* The Central Dot on the Track */
.timeline.view-horizontal .event::before {
  content: '';
  position: absolute;
  left: 50%;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--page-bg);
  /* Hollow look center */
  border: 3px solid var(--accent);
  transform: translateX(-50%);
  z-index: 2;
  box-shadow: 0 0 10px var(--accent-glow);
}

/* Dot Position */
/* The dot needs to be exactly at the container center.
   The card is shifted by (50% + 30px).
   So the center line is 30px away from the edge + 50% away from center ?
   
   Actually:
   Odd Card Bottom = Center - 30px.
   So Dot should be 30px below Bottom.
*/
.timeline.view-horizontal .event:nth-child(odd)::before {
  top: calc(100% + 30px - 7px);
  /* 30px gap - half dot height */
}

.timeline.view-horizontal .event:nth-child(even)::before {
  bottom: calc(100% + 30px - 7px);
}

/* Hover Effect: Highlight connector and dot */
.timeline.view-horizontal .event:hover::after {
  background: var(--accent);
  opacity: 1;
  width: 3px;
  box-shadow: 0 0 8px var(--accent);
}

.timeline.view-horizontal .event:hover::before {
  background: var(--accent);
  transform: translateX(-50%) scale(1.3);
}


/* --- EVENT CARD --- */
.event {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  min-width: var(--card-width);
  max-width: var(--card-width);
  padding: 20px;
  border-radius: var(--card-radius);
  box-shadow: var(--shadow);
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 5px;
  transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s;
  flex-shrink: 0;
  /* Don't shrink in flex row */
}

.event:hover {
  transform: translateY(-5px) scale(1.02);
  border-color: var(--accent);
  box-shadow: 0 0 20px var(--accent-glow);
  z-index: 10;
}

.event-accent {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--accent);
  margin-bottom: 10px;
  box-shadow: 0 0 10px var(--accent);
}

.event-date {
  font-size: 0.8rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.event-title {
  font-size: 1.2rem;
  margin: 0;
  font-weight: 700;
  color: var(--accent);
}

.event-desc {
  font-size: 0.9rem;
  line-height: 1.5;
  color: var(--text-main);
  opacity: 0.9;
  margin-top: 5px;
}

/* --- VIEW MODES --- */

/* 1. VERTICAL VIEW Override */
.timeline.view-vertical {
  flex-direction: column;
  overflow-y: auto;
  overflow-x: hidden;
  align-items: center;
  gap: 0;
  padding: 40px 0;
  position: relative;
  max-width: 1000px;
  /* Constrain width to keep items closer */
  margin: 0 auto;
}

/* Center line for vertical */
.timeline.view-vertical::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  bottom: 0;
  width: 2px;
  background: var(--card-border);
  transform: translateX(-50%);
  z-index: 0;
}

.timeline.view-vertical .event {
  width: 45%;
  max-width: 400px;
  /* Don't get too wide */
  margin-bottom: 40px;
  position: relative;
}

/* Alternating sides */
.timeline.view-vertical .event:nth-child(odd) {
  margin-right: auto;
  margin-left: 0;
  align-self: flex-start;
  text-align: right;
  align-items: flex-end;
  border-right: 3px solid var(--accent);
  border-left: 1px solid var(--card-border);
  right: 25px;
  /* Pull closer to center */
}

.timeline.view-vertical .event:nth-child(even) {
  margin-left: auto;
  margin-right: 0;
  align-self: flex-end;
  text-align: left;
  align-items: flex-start;
  border-left: 3px solid var(--accent);
  border-right: 1px solid var(--card-border);
  left: 25px;
  /* Pull closer to center */
}

/* Connectors for vertical */
.timeline.view-vertical .event::after {
  content: '';
  position: absolute;
  top: 20px;
  /* Using calc to accurately reach the center line from the card edge */
  /* If Card is 45%, Gap is 10%, half gap is 5%.
     Right side of Left Card is at 45%. Center is at 50%. Distance is 5% of container.
  */
  width: 12.5%;
  /* Calculated approximate width to bridge the gap comfortably */
  height: 2px;
  background: var(--accent);
}

.timeline.view-vertical .event:nth-child(odd)::after {
  right: -12.5%;
  /* Push comfortably to center */
}

.timeline.view-vertical .event:nth-child(even)::after {
  left: -12.5%;
}

/* 2. GRAPH VIEW Override */
.timeline.view-graph {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  overflow: auto;
  /* Scrollable window */
  padding: 0;
  /* Background logic moved to canvas or kept here? 
     If we keep background here, it stays fixed while content scrolls! That's cool.
     But we want background to scroll WITH content usually.
     Let's keep background here for now as a fixed grid, which is actually nicer. 
     Wait, if BG is fixed, dots will move but grid won't. 
     If dots move, grid MUST move.
  */
  background: none !important;
  /* Move BG to canvas */
}

/* New Canvas Class */
.graph-canvas {
  /* Dimensions set by JS */
  padding: 60px 20px 0 80px;
  background-image:
    linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
  background-size: 100% 100px, 8.33% 100%;
  box-sizing: border-box;
  /* Important so padding doesn't add to height */
}

/* Graph Labels */
.graph-axis-y {
  position: absolute;
  left: 10px;
  width: 60px;
  text-align: right;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-weight: bold;
}

.graph-axis-x {
  position: sticky;
  top: 0;
  left: 80px;
  right: 0;
  height: 40px;
  display: flex;
  background: var(--page-bg);
  z-index: 20;
  border-bottom: 1px solid var(--card-border);
}

.graph-month-label {
  flex: 1;
  text-align: center;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-weight: bold;
  padding-top: 10px;
  border-left: 1px solid rgba(255, 255, 255, 0.02);
}

/* DOT STYLE for Graph */
.timeline.view-graph .event {
  width: 16px;
  height: 16px;
  min-width: unset;
  padding: 0;
  border-radius: 50%;
  background: var(--card-bg);
  border: 2px solid var(--accent);
  position: absolute;
  transform: translate(-50%, -50%);
  cursor: pointer;
  overflow: visible;
  z-index: 5;
  transition: all 0.2s;
}

.timeline.view-graph .event:hover {
  background: var(--accent);
  box-shadow: 0 0 15px var(--accent);
  z-index: 100;
  transform: translate(-50%, -50%) scale(1.3);
}

/* Hide most internal details in dot mode */
.timeline.view-graph .event .event-date,
.timeline.view-graph .event .event-desc,
.timeline.view-graph .event .event-accent {
  display: none;
}

/* Show TITLE as a label next to dot */
.timeline.view-graph .event .event-title {
  display: block;
  position: absolute;
  left: 20px;
  top: -4px;
  width: max-content;
  font-size: 0.75rem;
  color: var(--text-muted);
  font-weight: normal;
  background: rgba(0, 0, 0, 0.5);
  padding: 2px 6px;
  border-radius: 4px;
  pointer-events: none;
  /* Let clicks pass to dot */
}

/* Hover State for Graph Item */
.timeline.view-graph .event:hover .event-title {
  color: var(--accent);
  background: var(--card-bg);
  border: 1px solid var(--accent);
  z-index: 10;
  font-weight: bold;
}

/* Detailed Popup on Hover (Re-using internal structure) */
.timeline.view-graph .event:hover .event-popup {
  display: flex;
}

/* Structure for popup */
.event-popup {
  display: none;
  position: absolute;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card-bg);
  border: 1px solid var(--accent);
  padding: 15px;
  border-radius: 8px;
  width: 250px;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 10px 30px black;
  pointer-events: none;
  text-align: left;
}

.event-popup h3 {
  color: var(--accent);
  margin: 0;
  font-size: 1rem;
}

.event-popup .date {
  color: var(--text-muted);
  font-size: 0.75rem;
  text-transform: uppercase;
}

.event-popup p {
  color: var(--text-main);
  font-size: 0.85rem;
  margin: 0;
}


/* Footer */
.site-footer {
  text-align: center;
  padding: 10px;
  font-size: 0.8rem;
  color: var(--text-muted);
  border-top: 1px solid var(--card-border);
  background: var(--card-bg);
}

/* Responsive */
@media (max-width: 768px) {
  .controls {
    width: 100%;
    justify-content: center;
  }

  .site-header {
    flex-direction: column;
    text-align: center;
  }

  /* Force vertical view on mobile for usability, or simplify layouts */
  .timeline.view-vertical .event {
    width: 90%;
    margin: 20px 0 !important;
    text-align: left !important;
    align-items: flex-start !important;
  }

  .timeline.view-vertical::before {
    left: 20px;
  }

  .timeline.view-vertical .event:nth-child(odd),
  .timeline.view-vertical .event:nth-child(even) {
    margin: 0 0 20px 40px;
    border: 1px solid var(--card-border);
    border-left: 3px solid var(--accent);
  }
}